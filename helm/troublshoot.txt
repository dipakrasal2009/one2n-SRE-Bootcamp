âœ… 1. COMPLETE TROUBLESHOOTING STEPS (What you debugged)
ğŸ”¹ 1. Pod stuck in CreateContainerConfigError

Root cause: Kubernetes Secret db-credentials missing

Fix:

kubectl create secret generic db-credentials \
  -n student-api \
  --from-literal=username=user \
  --from-literal=password=password

ğŸ”¹ 2. Vault secret existed but not in Kubernetes

Vault KV was populated but ExternalSecret was not created

Temporary fix used:

Manual Kubernetes secret creation

Lesson:

Vault â‰  Kubernetes Secret unless synced via ExternalSecrets

ğŸ”¹ 3. Init:CrashLoopBackOff for migrate-db

Root causes:

Wrong DB hostname (postgres)

DB not ready when migration ran

Fixes:

Correct hostname â†’ K8s service name

student-db


Add wait-for-db initContainer using pg_isready

ğŸ”¹ 4. DNS Resolution Error
could not translate host name "postgres"


Root cause:

App config used Docker-style hostname

Fix:

Updated api-config ConfigMap:

DB_HOST=student-db

ğŸ”¹ 5. Image Pull & Init sequencing verified

Ensured:

DB pod Running

DB Service exists

InitContainers execute in correct order

ğŸ”¹ 6. Application kept restarting (CrashLoopBackOff)

Root cause:

Liveness & Readiness probes hitting /

App returned 404

Fix:

Changed probes to real endpoint:

/healthcheck

ğŸ”¹ 7. Wrong container port

Root cause:

App running on 5000

Probes/service pointing to 5050

Fix:

Unified port = 5000

Updated:

Deployment

Probes

Service

ğŸ”¹ 8. Final Verification

Init containers:

wait-for-db â†’ âœ…

migrate-db â†’ âœ…

App container:

Gunicorn running

Probes passing

Pod state:

READY 1/1
STATUS Running

âœ… 2. ONE-GO COMMANDS TO DEPLOY EVERYTHING (HELM)

Run these from repo root (one2n-SRE-Bootcamp/helm)

ğŸ”¹ STEP 1: Create namespaces
kubectl create namespace vault --dry-run=client -o yaml | kubectl apply -f -
kubectl create namespace external-secrets --dry-run=client -o yaml | kubectl apply -f -
kubectl create namespace student-api --dry-run=client -o yaml | kubectl apply -f -

ğŸ”¹ STEP 2: Deploy External Secrets (if used)
helm repo add external-secrets https://charts.external-secrets.io
helm repo update

helm upgrade --install external-secrets external-secrets/external-secrets \
  -n external-secrets

ğŸ”¹ STEP 3: Deploy Vault
helm upgrade --install vault ./vault -n vault


(Optional verification)

kubectl get pods -n vault

ğŸ”¹ STEP 4: Create DB credentials (if NOT using ExternalSecrets)
kubectl create secret generic db-credentials \
  -n student-api \
  --from-literal=username=user \
  --from-literal=password=password

ğŸ”¹ STEP 5: Deploy PostgreSQL (student-db)
helm upgrade --install student-db ./student-db -n student-api


Verify:

kubectl get pods -n student-api
kubectl get svc -n student-api

ğŸ”¹ STEP 6: Deploy API application
helm upgrade --install student-api ./student-api -n student-api

ğŸ”¹ STEP 7: Restart pods (safe final sync)
kubectl delete pod -n student-api -l app.kubernetes.io/name=student-api

ğŸ”¹ STEP 8: Verify everything
kubectl get pods -n student-api -w


Expected:

student-db      1/1 Running
student-api     1/1 Running
student-stack   1/1 Running

ğŸ”¹ STEP 9: Access application
kubectl get svc -n student-api


Then:

curl http://<NODE-IP>:<NODE-PORT>/healthcheck


Expected:

{"status":"ok"}

ğŸ† FINAL NOTE (Important)

What you just did covers real interview & production scenarios:

Helm debugging

InitContainers

DB migrations

Probes

DNS & Services

Vault vs K8s secrets

CrashLoopBackOff root cause analysis

ğŸ’¯ This is NOT beginner-level Kubernetes.

If you want next:

Convert DB secret to ExternalSecret (Vault â†’ K8s)

Add startupProbe

Helm lint + CI

Draw architecture diagram for intervie
